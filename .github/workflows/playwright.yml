name: Playwright Tests
on:
    push:
        branches: [main, master, dev]
    pull_request:
        branches: [main, master, dev]
jobs:
    # vitest:
    #     runs-on: ubuntu-latest
    #     steps:
    #         - uses: actions/checkout@v4
    #         - uses: actions/setup-node@v4
    #           with:
    #               node-version: lts/*
    #         - name: Install dependencies
    #           run: npm install
    #         - name: Run vitest
    #           run: npm test
    e2e:
        timeout-minutes: 60
        runs-on: ubuntu-latest
        steps:
            - uses: actions/checkout@v4

            - uses: actions/setup-node@v4
              with:
                  node-version: lts/*

            - name: Send POST request with curl
              run: |
                  curl -X POST https://api.dev.exh-sandbox.extrahorizon.io/auth/v2/oauth2/tokens \
                    -H "Content-Type: application/json" \
                    -H "Authorization: Bearer ${{ secrets.PIPELINE_BEARER }}" \
                    -d '{"client_id": ${{secrets.PIPELINE_client_id}}, "client_secret": ${{secrets.PIPELINE_client_secret}}, "grant_type": ${{secrets.PIPELINE_grant_type}}, "password": ${{secrets.PIPELINE_password}}, "username": ${{secrets.PIPELINE_username}}}'
            # - name: Install dependencies
            #   run: npm install

            # - name: Build frontend Docker image
            #   run: docker build -t my-frontend .

            # - name: Run frontend container
            #   run: docker run -d -p 3000:3000 --name frontend my-frontend

            # - name: Wait for frontend to be ready
            #   run: |
            #       echo "Waiting for frontend to start..."
            #       for i in {1..20}; do
            #         if curl -s http://localhost:3000 > /dev/null; then
            #           echo "Frontend is up!"
            #           break
            #         fi
            #         echo "Still waiting..."
            #         sleep 3
            #       done

            # - name: Install Playwright Browsers
            #   run: npx playwright install --with-deps

            # - name: Run Playwright tests
            #   run: npx playwright test

            # - uses: actions/upload-artifact@v4
            #   if: ${{ !cancelled() }}
            #   with:
            #       name: playwright-report
            #       path: playwright-report/
            #       retention-days: 30
